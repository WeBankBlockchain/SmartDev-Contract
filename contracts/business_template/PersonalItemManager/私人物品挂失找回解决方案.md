# 私人物品挂失找回解决方案

> 作者：陈梓康
>
> 学校：深圳职业技术大学

基于区块链的物品找回解决方案适用于需要确保丢失物品信息的安全性和透明度的情景。区块链技术的特点，如去中心化、不可篡改和安全可靠，使其成为一种强大的工具，可以确保物品信息不会被篡改。同时，使用基于区块链的物品找回系统还可以提高整个找回过程的效率和透明度，不仅保护了失主的权益，还增强了找回服务的可信度和管理能力。因此，基于区块链的物品找回解决方案适用于各种需要找回丢失物品的情况，无论是私人物品还是重要文件

## 1.区块链技术如何协助挂失补办

1. **安全登记和存储**：
   
    区块链技术提供了一个安全的方式来登记私人物品信息。用户可以将他们的物品描述、图片、证书、甚至购买发票等信息上传到区块链。这些信息将被永久存储，且无法被篡改。
    
2. **挂失声明**：
   
    当用户丢失物品时，他们可以在区块链上发表一份挂失声明。这个声明将包括有关丢失物品的详细信息以及挂失的原因。
    
3. **重新补办请求**：
   
    通过区块链，用户可以提交重新补办请求。这个请求可以包括需要重新补办物品的类型（例如护照、驾照、信用卡等），以及与重新补办相关的具体需求。
    
4. **智能合约处理**：
   
    区块链上的智能合约将协助处理挂失和重新补办过程。合约可以根据挂失声明自动创建重新补办请求，并将其路由到相关的政府部门或服务提供商。
    
5. **支付和记录**：
   
    区块链还允许用户支付与重新补办相关的费用，并记录所有交易。这确保了整个流程的透明性，减少了纠纷的可能性。
    

**如何使用基于区块链的私人物品挂失补办解决方案**

1. **登记物品信息**：
    用户可以将他们拥有的物品信息登记到区块链上。这可以在物品购买时或任何时进行。

2. **发布挂失声明**：
    如果物品丢失，用户可以通过区块链发布挂失声明，提供详细信息以便后续的重新补办。

3. **提交重新补办请求**：
    用户可以使用智能合约提交重新补办请求，包括物品类型和具体需求。

4. **智能合约处理**：
    区块链上的智能合约将自动处理重新补办请求，并将其转发给相关的部门。

5. **支付和记录**：
    用户可以通过区块链支付与重新补办相关的费用，并在区块链上记录所有交易，以确保透明性。

## 2.基于Fisco Bcos的解决方案
1. **私人物品挂失**:
    通过FISCO BCOS，个人可以将他们拥有的物品信息记录在区块链上。一旦物品丢失，他们可以发表挂失声明，触发智能合约以通知其他用户和相关部门。

2. **找回流程**:
    找回物品的过程可以被自动化处理，智能合约可以创建重新补办请求，并将其自动路由到相关的机构，以加速挂失物品的找回。

3. **透明记录**:
    所有与挂失和找回有关的操作都将被透明记录在区块链上，任何人都可以验证。这增加了系统的透明性和可信度。

## 3.整体业务概述
1. **物品登记**:
    用户可以使用系统登记他们拥有的物品，提供物品描述、照片、购买证明等信息。这些信息将被记录在区块链上，形成一个安全的物品数据库。

2. **挂失声明**:
    一旦用户的物品丢失，他们可以通过系统发布挂失声明，提供详细信息，如丢失地点、时间、物品描述等。这个声明也被记录在区块链上，可追溯和验证。

3. **智能合约**:
    智能合约负责管理挂失和找回的流程。它可以自动化创建重新补办请求，通知相关的机构或拾得者，并确保整个过程的透明性和可靠性。

4. **重新补办请求**:
    丢失物品的挂失声明可以触发重新补办请求，这将包括与重新补办有关的所有必要信息。这个请求可以被发送到相关的部门，例如警察局、物品拾得者或其他相关机构。

5. **透明记录**:
    所有与挂失和找回有关的操作都将被透明记录在区块链上，以便任何人都可以验证。这增加了系统的可信度，减少了纠纷。

## 4.存储设计
### 4.1 用户存储设计
```solidity
contract User{
    string userName;                                    //用户名 用于标识
    uint256 personalItemAmount;                         //注册的私人物品数量
    bytes32 uuid;                                       //用户唯一UUID
    bytes32[] personalItemUUIDList = new bytes32[](0);  //用户私人物品UUID列表
    mapping(bytes32 => PersonalItem) personalItemMap;   //用户私人物品映射
}
```
### 4.2 物品存储设计
```solidity
contract PersonalItem{
    string itemName;            //物品名称，用于标识
    bytes32 uuid;               //物品唯一ID
    bytes32 avaliableUUID;      //物品唯一启用ID，用于辨识丢失物品
    int8 status = -1;           //物品状态 -1:未注册 0：正常 1：挂失 2：注销
}
```
### 4.3 平台存储设计
```solidity
contract PersonalItemManager{
    mapping(bytes32 => User) userMap;
    bytes32[] userIDList = new bytes32[](0);
}
```
## 5.接口设计
```solidity
/*
 * Name: register
 * Desc: 注册新用户
 * Param:
 *  @_userName(string)
 * Return: 
 *  @userUUID(bytes32)
 * Note: 用户名不唯一
**/
function register(string memory _userName)external returns(bytes32 userUUID)

/*
 * Name: queryUserIDList
 * Desc: 获取用户UUID列表
 * Return: 
 *  @userIDList(bytes32[])
**/
function queryUserIDList()external view returns(bytes32[] memory)

/*
 * Name: queryUserInfo
 * Desc: 查看用户信息
 * Param:
 *  @_userUUID(bytes32)
 * Returns: 
 *  @userName(string)
 *  @userItemAmount(uint256)
**/
function queryUserInfo(bytes32 _userUUID)external view userExistsOnly(_userUUID) returns(string memory,uint256)

/*
 * Name: queryUserItems
 * Desc: 查看用户物品列表
 * Param:
 *  @_userUUID(bytes32)
 * Return: 
 *  @personalItemUUIDList(bytes32[])
**/
function queryUserItems(bytes32 _userUUID)external view userExistsOnly(_userUUID) returns(bytes32[] memory)

/*
 * Name: queryUserItemInfo
 * Desc: 查看用户物品信息
 * Param:
 *  @_ownerUUID(bytes32)
 *  @_itemUUID(bytes32)
 * Return: 
 *  @name(string)
 *  @avaliableUUID(bytes32);
 *  @status(int8)
**/
function queryUserItemInfo(bytes32 _ownerUUID,bytes32 _itemUUID)external view userExistsOnly(_ownerUUID) returns(string memory,bytes32,int8)

/*
 * Name: registerPersonalItem
 * Desc: 注册私人物品
 * Param:
 *  @_itemName(string)
 *  @_ownerUUID(bytes32)
 * Return:
 *  @itemUUID(string)
**/
function registerPersonalItem(string memory _itemName,bytes32 _ownerUUID)external userExistsOnly(_ownerUUID) returns(bytes32)

/*
 * Name: reportPersonalItema
 * Desc: 挂失私人物品
 * Param:
 *  @_ownerUUID(string)
 *  @_itemUUID(bytes32)
 * Return:
 *  @success(bool)
**/
function reportPersonalItem(bytes32 _ownerUUID,bytes32 _itemUUID)external userExistsOnly(_ownerUUID) returns(bool)

/*
 * Name: retrievePersonalItem
 * Desc: 找回私人物品
 * Param:
 *  @_ownerUUID(string)
 *  @_itemUUID(bytes32)
 * Return:
 *  @success(bool)
**/
function retrievePersonalItem(bytes32 _ownerUUID,bytes32 _itemUUID)external userExistsOnly(_ownerUUID) returns(bool)

/*
 * Name: unregisterPersonalItem
 * Desc: 注销私人物品
 * Param:
 *  @_ownerUUID(string)
 *  @_itemUUID(bytes32)
 * Return:
 *  @success(bool)
**/
function unregisterPersonalItem(bytes32 _ownerUUID,bytes32 _itemUUID)external userExistsOnly(_ownerUUID) returns(bool)
```
### 合约设计类图
![image.png](https://github.com/Mu-cream/image/blob/master/Pasted%20image%2020231019142800.png?raw=true)
### 合约功能概览图
![image.png](https://github.com/Mu-cream/image/blob/master/Pasted%20image%2020231019142919.png?raw=true)
## 6.合约详细
### 6.1 用户注册
```solidity
contract PersonalItemManager{
    /*
     * Name: register
     * Desc: 注册新用户
     * Param:
     *  @_userName(string)
     * Return: 
     *  @userUUID(bytes32)
     * Note: 用户名不唯一
    **/
    function register(string memory _userName)external returns(bytes32 userUUID){
        User newUser = new User(_userName,,userIDList.length);
        userUUID = newUser.getUUID();
        userIDList.push(userUUID);
        userMap[userUUID] = newUser;
        return userUUID;
    }
}

contract User{
    constructor(string memory _userName,uint256 cIndex) public{
        userName = _userName;
        uuid = keccak256(abi.encodePacked((uint256(keccak256(bytes(_userName))) ^ now)>>cIndex));
        personalItemAmount = 0;
    }
}
```
### 6.2 查询所有用户
```solidity
/*
 * Name: queryUserIDList
 * Desc: 获取用户UUID列表
 * Return: 
 *  @userIDList(bytes32[])
**/
function queryUserIDList()external view returns(bytes32[] memory){
    return userIDList;
}
```
### 6.3 查询用户信息
```solidity
contract PersonalItemManager{
    /*
     * Name: queryUserInfo
     * Desc: 查看用户信息
     * Param:
     *  @_userUUID(bytes32)
     * Returns: 
     *  @userName(string)
     *  @userItemAmount(uint256)
    **/
    function queryUserInfo(bytes32 _userUUID)external view userExistsOnly(_userUUID) returns(string memory,uint256){
        return userMap[_userUUID].getInfo();
    }
}

contract User{
    function getInfo()external view returns(string memory,uint256){
        return (userName,personalItemAmount);
    }
}
```
### 6.4 查询用户物品列表
```solidity
contract PersonalItemManager{
    /*
     * Name: queryUserItems
     * Desc: 查看用户物品列表
     * Param:
     *  @_userUUID(bytes32)
     * Return: 
     *  @personalItemUUIDList(bytes32[])
    **/
    function queryUserItems(bytes32 _userUUID)external view userExistsOnly(_userUUID) returns(bytes32[] memory){
        return userMap[_userUUID].getPersonalItems();
    }
}

contract User{
    function getPersonalItems()external view returns(bytes32[] memory){
        return personalItemUUIDList;
    }
}
```
### 6.5 查询用户物品信息
```solidity
contract PersonalItemManager{
    /*
     * Name: queryUserItemInfo
     * Desc: 查看用户物品信息
     * Param:
     *  @_ownerUUID(bytes32)
     *  @_itemUUID(bytes32)
     * Return: 
     *  @name(string)
     *  @avaliableUUID(bytes32);
     *  @status(int8)
    **/
    function queryUserItemInfo(bytes32 _ownerUUID,bytes32 _itemUUID)external view userExistsOnly(_ownerUUID) returns(string memory,bytes32,int8){
        return userMap[_ownerUUID].getItemInfo(_itemUUID);
    }
}

contract User{
    function getItemInfo(bytes32 _itemUUID)external view itemExistsOnly(_itemUUID) returns(string memory,bytes32,int8){
        return personalItemMap[_itemUUID].getInfo();
    }
}
```
### 6.6 注册私人物品
```solidity
contract PersonalItemManager{
    /*
     * Name: registerPersonalItem
     * Desc: 注册私人物品
     * Param:
     *  @_itemName(string)
     *  @_ownerUUID(bytes32)
     * Return:
     *  @itemUUID(string)
    **/
    function registerPersonalItem(string memory _itemName,bytes32 _ownerUUID)external userExistsOnly(_ownerUUID) returns(bytes32){
        return userMap[_ownerUUID].addPersonalItem(_itemName);
    }
}

contract User{
    //注册私人物品
    function addPersonalItem(string memory _itemName)external returns(bytes32 itemUUID){
        PersonalItem newItem = new PersonalItem(_itemName,personalItemUUIDList.length);
        itemUUID = newItem.getUUID();
        personalItemUUIDList.push(itemUUID);
        personalItemMap[itemUUID] = newItem;
        personalItemAmount++;
        return itemUUID;
    }
}
contract PersonalItem{
    constructor(string memory _itemName,uint256 cIndex) public{
        itemName = _itemName;
        uuid = keccak256(abi.encodePacked((uint256(keccak256(bytes(_itemName))) ^ now)+cIndex));
        generateAvaliableUUID();
        status = 0;
    }
    function generateAvaliableUUID()internal registerOnly notAvaliable{
        avaliableUUID = keccak256(abi.encodePacked(uint256(uuid) ^ now));
    }
}
```
### 6.7 挂失私人物品
```solidity
contract PersonalItemManager{
    /*
     * Name: reportPersonalItema
     * Desc: 挂失私人物品
     * Param:
     *  @_ownerUUID(string)
     *  @_itemUUID(bytes32)
     * Return:
     *  @success(bool)
    **/
    function reportPersonalItem(bytes32 _ownerUUID,bytes32 _itemUUID)external userExistsOnly(_ownerUUID) returns(bool){
        return userMap[_ownerUUID].reportPersonalItem(_itemUUID);
    }
}

contract User{
    //挂失私人物品
    function reportPersonalItem(bytes32 _itemUUID)external itemExistsOnly(_itemUUID) returns(bool){
        return personalItemMap[_itemUUID].report();
    }
}

contract PersonalItem{
    //挂失物品
    function report()external registerOnly avaliableOnly returns(bool){
        avaliableUUID = bytes32(0);
        status = 1;
        return true;
    }
}
```
### 6.8 找回私人物品
```solidity
contract PersonalItemManager{
    /*
     * Name: retrievePersonalItem
     * Desc: 找回私人物品
     * Param:
     *  @_ownerUUID(string)
     *  @_itemUUID(bytes32)
     * Return:
     *  @success(bool)
    **/
    function retrievePersonalItem(bytes32 _ownerUUID,bytes32 _itemUUID)external userExistsOnly(_ownerUUID) returns(bool){
        return userMap[_ownerUUID].retrievePersonalItem(_itemUUID);
    }
}

contract User{
    //找回私人物品
    function retrievePersonalItem(bytes32 _itemUUID)external itemExistsOnly(_itemUUID) returns(bool){
        return personalItemMap[_itemUUID].retrieve();
    }
}

contract PersonalItem{
    //找回物品
    function retrieve()external registerOnly notAvaliable returns(bool){
        generateAvaliableUUID();
        status = 0;
        return true;
    }
}
```
### 6.9 注销私人物品
```solidity
contract PersonalItemManager{
    /*
     * Name: unregisterPersonalItem
     * Desc: 注销私人物品
     * Param:
     *  @_ownerUUID(string)
     *  @_itemUUID(bytes32)
     * Return:
     *  @success(bool)
    **/
    function unregisterPersonalItem(bytes32 _ownerUUID,bytes32 _itemUUID)external userExistsOnly(_ownerUUID) returns(bool){
        return userMap[_ownerUUID].unregisterPersonalItem(_itemUUID);
    }
}

contract User{
    //注销私人物品
    function unregisterPersonalItem(bytes32 _itemUUID)external itemExistsOnly(_itemUUID) returns(bool result){
        result = personalItemMap[_itemUUID].unregister();
        personalItemAmount--;
        return result;
    }
}

contract PersonalItem{
    //注销物品
    function unregister()external registerOnly returns(bool){
        avaliableUUID = bytes32(0);
        status = 2;
        return true;
    }
}
```
## 7. 合约业务测试
### 测试用例
```js
const manager = artifacts.require("PersonalItemManager");

function divider(){
    console.log("\n===================================================================================");
}

contract("私人物品绑定合约系统测试", async accounts => {
    var userIDList;
    var zhangSanUUID;
    var studentCardUUID;


    it("用户注册功能&列表查询测试", async () => {
        divider()
        const managerInstance = await manager.deployed();

        await managerInstance.register("张三");//注册用户：张三
        await managerInstance.register("李四");//注册用户：李四
        await managerInstance.register("张三");//注册同名用户：张三
        
        userIDList = await managerInstance.queryUserIDList();//查询所有用户UUID
        zhangSanUUID = userIDList[0];
        console.log(("用户UUID："+userIDList).replaceAll(",","\n用户UUID："));

        console.log("\n李四注册信息：")
        const res = await managerInstance.queryUserInfo(userIDList[1]);//查询用户注册物品信息
        console.log("姓名："+res[0]+"\n注册私人物品数量："+res[1]);
    });

    it("私人物品注册&列表查询测试", async () => {
        divider()
        const managerInstance = await manager.deployed();
        zhangSanUUID = userIDList[0];

        await managerInstance.registerPersonalItem("学生卡",zhangSanUUID); //注册学生卡
        await managerInstance.registerPersonalItem("饭卡",zhangSanUUID);   //注册饭卡
        await managerInstance.registerPersonalItem("饭卡",zhangSanUUID);   //注册同名饭卡

        itemIDList = await managerInstance.queryUserItems(zhangSanUUID);//查询用户所有注册物品UUID
        studentCardUUID = itemIDList[0];
        console.log(("张三私人物品UUID："+itemIDList).replaceAll(",","\n张三私人物品UUID："));

        console.log("\n学生卡注册信息：")
        const res = await managerInstance.queryUserItemInfo(zhangSanUUID,studentCardUUID);//查询用户注册物品信息
        console.log("物品："+res[0]+"\n活跃UUID："+res[1]+"\n状态："+res[2]+"（-1：未注册；0：正常；1：挂失；2：注销）");
    });

    it("私人物品挂失&信息查询测试", async () => {
        divider()
        const managerInstance = await manager.deployed();

        await managerInstance.reportPersonalItem(zhangSanUUID,studentCardUUID); //挂失学生卡

        const res = await managerInstance.queryUserItemInfo(zhangSanUUID,studentCardUUID);//查询用户注册物品信息
        console.log("物品："+res[0]+"\n活跃UUID："+res[1]+"\n状态："+res[2]+"（-1：未注册；0：正常；1：挂失；2：注销）");
    });

    it("私人物品找回&信息查询测试", async () => {
        divider()
        const managerInstance = await manager.deployed();

        await managerInstance.retrievePersonalItem(zhangSanUUID,studentCardUUID); //找回学生卡

        const res = await managerInstance.queryUserItemInfo(zhangSanUUID,studentCardUUID);//查询用户注册物品信息
        console.log("物品："+res[0]+"\n活跃UUID："+res[1]+"\n状态："+res[2]+"（-1：未注册；0：正常；1：挂失；2：注销）");
    });

    it("私人物品注销&信息查询测试", async () => {
        divider()
        const managerInstance = await manager.deployed();

        await managerInstance.unregisterPersonalItem(zhangSanUUID,studentCardUUID); //注销学生卡

        const res = await managerInstance.queryUserItemInfo(zhangSanUUID,studentCardUUID);//查询用户注册物品信息
        console.log("物品："+res[0]+"\n活跃UUID："+res[1]+"\n状态："+res[2]+"（-1：未注册；0：正常；1：挂失；2：注销）");
    });
})

```
### 测试结果：
![image.png](https://github.com/Mu-cream/image/blob/master/Pasted%20image%2020231019161558.png?raw=true)
